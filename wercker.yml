box:
  id: openpne/openpne3-env:latest
build:
  steps:
    - install-packages:
      packages: git
    - script:
        name: pre settings
        code: |
          git clone --depth=1 git://github.com/upsilon/opIgnoreKnownErrorsPlugin.git plugins/opIgnoreKnownErrorsPlugin
          service mysql start
    - script:
        name: server info
        code: |
          service mysql status
          php -i
    - script:
        name: install OpenPNE
        code: |
          cp config/ProjectConfiguration.class.php{.sample,}
          cp config/OpenPNE.yml{.sample,}
          php symfony openpne:fast-install --dbms=mysql --dbhost="localhost" --dbuser="root" --dbname="openpne3" --dbsock="/var/run/mysqld/mysqld.sock"
    - script:
        name: PHPUnit integration tests
        code: |-
          ./phpunit.phar test/phpunit/
